package fr.ign.validator.model.type;

import static org.junit.Assert.assertEquals;

import org.junit.Test;
import org.opengis.referencing.FactoryException;
import org.opengis.referencing.NoSuchAuthorityCodeException;

import com.vividsolutions.jts.geom.Geometry;

import fr.ign.validator.error.CoreErrorCodes;

/**
 * 
 * @author CBouche
 *
 */
public class GeometryTypeTest extends AbstractTypeTest<Geometry> {

    public GeometryTypeTest() {
        super(new GeometryType());
    }

    @Test
    public void testCheckAttributeNotValidGeometry() throws NoSuchAuthorityCodeException, FactoryException {
        String wkt = "MULTIPOLYGON (((593138.88353882008 6705050.6669603009,593198.21159106505 6705067.6010473119,593209.34827088309 6705041.1812831517,593222.00319674914 6705011.2872307487,593207.06874521158 6705006.6682348186,593193.97602964705 6705003.7919615079,593197.60558660561 6705016.9482900118,593197.53010562307 6705016.9482900118,593197.60774320504 6705017.169198513,593197.81477675715 6705020.2775373198,593200.79088406707 6705022.2233172478,593190.91150175757 6705047.2886222145,593191.12284850865 6705042.1742557064,593168.69637030805 6705035.9107187139,593176.47306810506 6705011.4389658803,593197.53010562307 6705016.9482900118,593193.97602964705 6705003.7919615079,593158.96794996364 6704993.7528974069,593155.37074199761 6704999.1506515881,593154.40027222259 6705003.8343580887,593150.34370856313 6705008.7969894651,593145.2045319546 6705016.4439938376,593142.10981167213 6705028.8327210853,593142.86677809665 6705037.3745164573,593138.88353882008 6705050.6669603009)),((593202.93023077108 6705070.0712060044,593201.2006379721 6705074.4358224487,593205.59794435254 6705075.9130085865,593207.07090181112 6705073.9984682444,593210.24541627511 6705074.3845002716,593212.56807393662 6705073.6771467887,593252.69592083304 6705087.5118205892,593253.43132126261 6705090.7205723505,593255.42833239958 6705092.7957734205,593257.08675741509 6705092.7667652341,593258.34836812259 6705087.5207461845,593257.25712877559 6705085.541495272,593270.28083315608 6705050.8633234128,593275.63782631408 6705034.3241940243,593278.25809470657 6705033.277667894,593279.52617521258 6705028.3663586946,593274.54658696707 6705028.1231362037,593271.81201880111 6705031.1712272381,593226.50401990558 6705014.3174705906,593226.46520111454 6705012.0972285857,593229.15663729061 6705010.8253311561,593227.85620779207 6705005.628402885,593225.28338458855 6705005.0080739623,593221.48776946857 6705007.7415377377,593222.07005133363 6705010.8431823477,593223.60555017763 6705012.369459264,593220.68335785507 6705021.7547234576,593263.56086911412 6705037.6512099337,593259.72212200414 6705050.6089439271,593267.67566096014 6705052.8001777446,593261.41505261161 6705069.3549269261,593254.49668141559 6705066.036836613,593250.1576032216 6705076.3347429978,593209.73214559408 6705062.6161019458,593209.68254380557 6705064.0620484976,593206.05730004609 6705063.6827106681,593204.81078553514 6705065.5950196106,593204.85607412457 6705068.147740067,593202.93023077108 6705070.0712060044)))";
        context.setProjection("EPSG:2154");
        bindValidate(context, wkt);
        assertEquals(1, reportBuilder.countErrors(CoreErrorCodes.ATTRIBUTE_GEOMETRY_INVALID));
    }

    @Test
    public void testCheckAttributeValidGeometry() throws NoSuchAuthorityCodeException, FactoryException {
        String wkt = "POLYGON ((574353.3 6880586.115,574357.62 6880597.185,574363.71 6880612.47,574377.96 6880644.525,574381.23 6880652.175,574380.99 6880652.4,574379.16 6880653.33,574362.84 6880659.075,574340.25 6880666.83,574341.87 6880697.04,574360.5 6880695.855,574811.64 6880666.905,574812.21 6880666.785,574812.54 6880666.785,575144.04 6880642.95,575497.65 6880617.795,575532.84 6880609.365,575534.22 6880608.33,575508.0 6880582.89,575449.26 6880525.56,575440.8 6880514.76,575439.39 6880511.685,575434.62 6880501.635,575397.03 6880443.675,575389.62 6880432.395,575388.33 6880430.355,575373.15 6880406.205,575128.38 6880423.59,575128.38 6880423.59,575128.26 6880423.59,574797.21 6880447.53,574346.88 6880476.36,574347.84 6880480.125,574361.34 6880533.255,574361.94 6880535.655,574338.87 6880544.325,574342.29 6880554.72,574348.38 6880571.04,574349.31 6880573.545,574353.3 6880586.115))";
        context.setProjection("EPSG:2154");
        bindValidate(context, wkt);
        assertEquals(0, reportBuilder.countErrors());
    }

}
